flowchart TD

%% =====================
%% UI LAYER
%% =====================
subgraph UILayer["UI Layer"]
    direction TB
    UIApp["app.py"]:::ui
    UICSS["css.py"]:::ui
    UIScreenLib["library.py"]:::ui
    UIScreenLogin["login.py"]:::ui
    UIScreenMedia["media.py"]:::ui
    UIScreenModals["modals.py"]:::ui
    UIScreenServer["server.py"]:::ui
end

%% =====================
%% API CLIENT
%% =====================
subgraph APIClient["API Client"]
    direction TB
    API["jellyfin.py"]:::api
end

%% =====================
%% MODELS
%% =====================
subgraph ModelsLayer["Models"]
    direction TB
    Models["media.py"]:::model
end

%% =====================
%% PLAYBACK
%% =====================
subgraph Playback["Playback"]
    direction TB
    Tracker["tracker.py"]:::infra
end

%% =====================
%% CONFIGURATION
%% =====================
subgraph Configuration["Configuration"]
    direction TB
    Config["config.py"]:::infra
end

%% =====================
%% UTILITIES
%% =====================
subgraph Utilities["Utilities"]
    direction TB
    UtilsDir["utils/"]:::infra
    TimeUtil["time.py"]:::infra
end

%% =====================
%% EXTERNAL SYSTEMS
%% =====================
JellyfinServer["Jellyfin Server<br/>(REST API + OIDC)"]:::external
Browser["Web Browser"]:::external
MPV["mpv Player"]:::external

%% =====================
%% RELATIONSHIPS
%% =====================
UIApp -->|"HTTP GET/POST<br/>JSON"| API
API -->|"GET /Users/.../Items"| JellyfinServer
JellyfinServer -->|"JSON"| API

API -->|"Open browser for OIDC"| Browser
Browser -->|"OIDC callback (code)"| API

API -->|"PATCH resume position"| JellyfinServer

UIApp -->|"Obtain playback URL"| Tracker
Tracker -->|"Launch mpv"| MPV
Tracker -->|"POST resume position"| API

API -->|"Maps to"| Models
UIApp -->|"Uses domain objects"| Models

Config -->|"Loads on startup"| UIApp
UtilsDir -->|"Helpers"| UIApp
UtilsDir -->|"Helpers"| API

TimeUtil -->|"Formats timestamps"| UIScreenLib
TimeUtil -->|"Formats timestamps"| UIScreenLogin
TimeUtil -->|"Formats timestamps"| UIScreenMedia
TimeUtil -->|"Formats timestamps"| UIScreenModals
TimeUtil -->|"Formats timestamps"| UIScreenServer

%% =====================
%% CLICKABLE FILE LINKS
%% =====================
click UIApp "https://github.com/daudk3/jellycli/blob/master/ui/app.py"
click UICSS "https://github.com/daudk3/jellycli/blob/master/ui/css.py"
click UIScreenLib "https://github.com/daudk3/jellycli/blob/master/ui/screens/library.py"
click UIScreenLogin "https://github.com/daudk3/jellycli/blob/master/ui/screens/login.py"
click UIScreenMedia "https://github.com/daudk3/jellycli/blob/master/ui/screens/media.py"
click UIScreenModals "https://github.com/daudk3/jellycli/blob/master/ui/screens/modals.py"
click UIScreenServer "https://github.com/daudk3/jellycli/blob/master/ui/screens/server.py"
click API "https://github.com/daudk3/jellycli/blob/master/api/jellyfin.py"
click Models "https://github.com/daudk3/jellycli/blob/master/models/media.py"
click Tracker "https://github.com/daudk3/jellycli/blob/master/playback/tracker.py"
click Config "https://github.com/daudk3/jellycli/blob/master/config.py"
click UtilsDir "https://github.com/daudk3/jellycli/tree/master/utils/"
click TimeUtil "https://github.com/daudk3/jellycli/blob/master/utils/time.py"

%% =====================
%% STYLES
%% =====================
classDef ui fill:#BBDEFB,stroke:#1E88E5,color:#0D47A1
classDef api fill:#C8E6C9,stroke:#43A047,color:#1B5E20
classDef model fill:#FFF9C4,stroke:#FBC02D,color:#F57F17
classDef infra fill:#E0E0E0,stroke:#9E9E9E,color:#424242
classDef external fill:#FFE0B2,stroke:#FB8C00,color:#E65100
